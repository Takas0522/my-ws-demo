# アクターとユースケースの文書化

## アクター
- **アクター名**: ユーザー
- **役割**: システムを利用して自身のポイント情報を参照する。
- **権限**: 自分のポイント情報のみ参照可能。
- **関係**: 他のアクター（管理者など）は存在しない。

## ユースケース
### 2-1. ポイントの参照
- **ユースケース名**: ポイント参照
- **目的**: ユーザーが自身のポイント残高と履歴を確認する。
- **アクター**: ユーザー
- **トリガー**: ユーザーがポイント参照画面を開く。
- **前提条件**: 
  - ユーザーがログインしている。
  - JWTトークンが有効である。
- **基本フロー**:
  1. ユーザーがポイント参照画面を開く。
  2. システムが現在のポイント残高を表示する。
  3. 履歴情報を取得し、画面に表示する。
- **代替フロー**:
  - JWTトークンが無効の場合、認証エラーを返す。
- **事後条件**:
  - ユーザーがポイント残高と履歴を確認できる。
- **システムの責務**:
  - ポイント残高と履歴情報を正確に取得し、表示する。

## ポイント管理
- **ポイントの種類**: 通常ポイントのみ。単位は「pt」。
- **ポイントの有効期限**: 半年（失効後もデータは保持）。
- **履歴情報**:
  - ポイントの付与・利用履歴を表示。
  - 履歴情報は別サービスから登録される。
- **内部向けWebAPI**:
  - ポイント情報の登録・参照用APIを提供（POST /points/register）。
  - ポイント利用用APIを提供（POST /points/use）。UI画面からの利用は不要だが、WebAPI経由で他サービスが利用可能。
  - 他サービスが利用可能。

## システム設計
- **アーキテクチャ**: マイクロサービス構成。
- **データベース**:
  - 独自のDBを持つ。
  - ポイント情報と履歴情報を管理。
- **データフロー**:
  - ユーザーが画面を操作 → BFF → ポイント管理サービス → DBからデータ取得 → BFF → フロントエンドにデータを返却。
- **エラーハンドリング**:
  - 集約例外を使用。
  - 個別のエラー処理は最小限。
- **セキュリティ**:
  - JWTを使用してユーザー認証。
  - リクエストパラメータにユーザー情報を含めない。
  - **JWT検証**: BFFとPointServiceの両方でJWT検証を実施。
  - **JWT構造**: JWTペイロードには `userId` クレーム（UUID形式）が必須。PointServiceはJWTからユーザーIDを抽出して使用。

## 技術要件
- **バックエンド**: Java 11 + Payara
- **フロントエンド**: Vue 3
- **データベース**: PostgreSQL
- **API仕様**:
  - RESTful API
  - JWT認証を使用
- **エラーハンドリング**:
  - HTTPステータスコードを適切に使用（例: 401 Unauthorized, 500 Internal Server Error）。

## 議論の記録
- **背景**: ユーザーが自身のポイント情報を参照できる機能を提供する必要がある。
- **議論内容**:
  - ポイントの付与・利用は別サービスで管理。
  - 本サービスでは参照機能に特化。
  - JWTを使用した認証を採用。
- **決定事項**:
  - ポイント管理サービスをPayaraで構築。
  - 履歴情報をDBに保持し、参照可能にする。
- **未解決事項**:
  - WebAPIの詳細な仕様（エンドポイント、リクエスト/レスポンス形式）。