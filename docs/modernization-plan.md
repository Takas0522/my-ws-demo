# Java 21 + Payara 6 + Jakarta EE 10 ç§»è¡Œè¨ˆç”»æ›¸

## æ¦‚è¦

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ç¾åœ¨ã®Java 11 + Payara Micro 5.2022.5 + Jakarta EE 8ç’°å¢ƒã‹ã‚‰ã€Java 21 + Payara Micro 6.2024.10 + Jakarta EE 10ã¸ã®ç§»è¡Œã«å¿…è¦ãªäº’æ›æ€§èª¿æŸ»çµæœã¨ç§»è¡Œè¨ˆç”»ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚

## ç¾åœ¨ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å‚™è€ƒ |
|--------------|-----------------|------|
| Java | 11 | OpenJDK 11 |
| Payara Micro | 5.2022.5 | Jakarta EE 8å¯¾å¿œ |
| Jakarta EE | 8.0.0 | javax.* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ |
| Jersey | 2.35 | JAX-RSå®Ÿè£…ï¼ˆBFFã®HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ |
| jbcrypt | 0.4 | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆ2014å¹´ç‰ˆï¼‰ |
| PostgreSQL Driver | 42.5.1 | |
| TestContainers | 1.19.3 | çµ±åˆãƒ†ã‚¹ãƒˆç”¨ |

## ç§»è¡Œå¾Œã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ç§»è¡Œå¾Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å‚™è€ƒ |
|--------------|-------------------|------|
| Java | 21 | LTSç‰ˆ |
| Payara Micro | 6.2024.10 | Jakarta EE 10å¯¾å¿œ |
| Jakarta EE | 10.0.0 | jakarta.* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ |
| Jersey | 3.1.x | Jakarta namespaceå¯¾å¿œ |
| bcrypt | 0.10.2 (at.favre.lib) | äº’æ›APIã‚’æŒã¤ãƒ¢ãƒ€ãƒ³å®Ÿè£… |
| PostgreSQL Driver | 42.7.x | Java 21å¯¾å¿œç‰ˆ |
| TestContainers | 1.19.x | ç¶­æŒ |

---

## èª¿æŸ»çµæœ

### 1. jbcryptäº’æ›æ€§èª¿æŸ»

#### ç¾çŠ¶åˆ†æ

- **ç¾åœ¨**: org.mindrot:jbcrypt 0.4ï¼ˆ2014å¹´ç‰ˆã€æœ€çµ‚æ›´æ–°2014å¹´ï¼‰
- **ç›®æ¨™**: at.favre.lib:bcrypt 0.10.2ï¼ˆãƒ¢ãƒ€ãƒ³å®Ÿè£…ã€Maven Centralã§å…¬é–‹ï¼‰
- **ä½¿ç”¨ç®‡æ‰€**: auth-serviceã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆãƒ»æ¤œè¨¼

#### äº’æ›æ€§è©•ä¾¡

**âœ… å®Œå…¨äº’æ›**

at.favre.lib:bcryptã¯ã€org.mindrot:jbcryptã¨åŒã˜BCryptã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…ã—ã¦ãŠã‚Šã€ä»¥ä¸‹ã®ç‚¹ã§å®‰å…¨ã«ç§»è¡Œå¯èƒ½ï¼š

1. **ãƒãƒƒã‚·ãƒ¥ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®äº’æ›æ€§**
   - BCryptã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è‡ªä½“ã¯å¤‰æ›´ãªã—
   - æ—¢å­˜ã®`BCrypt.hashpw()`ã¨`BCrypt.checkpw()`ã®APIã¯å®Œå…¨äº’æ›
   - æ—¢å­˜DBã«ä¿å­˜ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã¯å¼•ãç¶šãæ¤œè¨¼å¯èƒ½

2. **ä¸»ãªå¤‰æ›´ç‚¹ï¼ˆorg.mindrot â†’ at.favre.libï¼‰**
   - å®Œå…¨ãªå†å®Ÿè£…ï¼ˆã‚ˆã‚Šä¿å®ˆã•ã‚Œã¦ã„ã‚‹ç¾ä»£çš„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰
   - Java 8ä»¥é™ã¸ã®æœ€é©åŒ–
   - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•æ€§ã®æ”¹å–„
   - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ¡ç”¨
   - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆå®šæœŸçš„ãªæ›´æ–°ï¼‰

3. **å½±éŸ¿ç¯„å›²**
   - auth-service: `src/auth-service/pom.xml`ã®ä¾å­˜é–¢ä¿‚ã®ã¿
   - ã‚³ãƒ¼ãƒ‰å¤‰æ›´: **ä¸è¦**ï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯`org.mindrot`ã®ã¾ã¾ï¼‰
   - ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: **ä¸è¦**

#### ç§»è¡Œæ‰‹é †

```xml
<!-- pom.xml: å¤‰æ›´å‰ -->
<dependency>
    <groupId>org.mindrot</groupId>
    <artifactId>jbcrypt</artifactId>
    <version>0.4</version>
</dependency>

<!-- pom.xml: å¤‰æ›´å¾Œï¼ˆæ¨å¥¨ï¼‰ -->
<dependency>
    <groupId>at.favre.lib</groupId>
    <artifactId>bcrypt</artifactId>
    <version>0.10.2</version>
</dependency>
```

**æ³¨**: at.favre.lib:bcryptã¯ã€org.mindrot:jbcryptã®APIã¨å®Œå…¨äº’æ›ã§ã™ãŒã€ã‚ˆã‚Šä¿å®ˆã•ã‚Œã¦ãŠã‚Šã€Java 21ã§ã‚‚ç¶™ç¶šçš„ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹å¯èƒ½æ€§ãŒé«˜ã„ãŸã‚æ¨å¥¨ã—ã¾ã™ã€‚importæ–‡ã‚„ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã¯ä¸è¦ã§ã™ã€‚

#### æ¤œè¨¼è¨ˆç”»

1. æ—¢å­˜ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã§æ¤œè¨¼ãƒ†ã‚¹ãƒˆå®Ÿæ–½
2. æ–°è¦ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆã¨æ¤œè¨¼ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
3. çµ±åˆãƒ†ã‚¹ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª

---

### 2. Jerseyäº’æ›æ€§èª¿æŸ»

#### ç¾çŠ¶åˆ†æ

- **ç¾åœ¨**: Jersey 2.35ï¼ˆjavax.* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰
- **ç›®æ¨™**: Jersey 3.1.xï¼ˆjakarta.* ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰
- **ä½¿ç”¨ç®‡æ‰€**: BFFï¼ˆBackend For Frontendï¼‰ã®HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

**ä½¿ç”¨ã—ã¦ã„ã‚‹Jerseyã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:
- `jersey-client`: HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ
- `jersey-hk2`: ä¾å­˜æ€§æ³¨å…¥
- `jersey-server`: ãƒ†ã‚¹ãƒˆç”¨ï¼ˆtestã‚¹ã‚³ãƒ¼ãƒ—ï¼‰

#### äº’æ›æ€§è©•ä¾¡

**âš ï¸ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åå¤‰æ›´ã‚ã‚Šï¼ˆç ´å£Šçš„å¤‰æ›´ï¼‰**

Jersey 3.xã¸ã®ç§»è¡Œã«ã¯ä»¥ä¸‹ã®å¤‰æ›´ãŒå¿…è¦ï¼š

1. **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã®å¤‰æ›´**
   ```java
   // å¤‰æ›´å‰ï¼ˆJersey 2.xï¼‰
   import javax.ws.rs.*;
   import org.glassfish.jersey.client.*;
   
   // å¤‰æ›´å¾Œï¼ˆJersey 3.xï¼‰
   import jakarta.ws.rs.*;
   import org.glassfish.jersey.client.*;
   ```

2. **Mavenä¾å­˜é–¢ä¿‚ã®å¤‰æ›´**
   ```xml
   <!-- å¤‰æ›´å‰ -->
   <dependency>
       <groupId>org.glassfish.jersey.core</groupId>
       <artifactId>jersey-client</artifactId>
       <version>2.35</version>
   </dependency>
   
   <!-- å¤‰æ›´å¾Œ -->
   <dependency>
       <groupId>org.glassfish.jersey.core</groupId>
       <artifactId>jersey-client</artifactId>
       <version>3.1.5</version>
   </dependency>
   ```

3. **å½±éŸ¿ç¯„å›²**
   - `src/bff/src/main/java/com/example/microservices/bff/client/` é…ä¸‹ã®å…¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¯ãƒ©ã‚¹
     - `UserServiceClient.java`
     - `AuthServiceClient.java`
     - `PointServiceClient.java`
   - `src/bff/src/main/java/com/example/microservices/bff/rest/BffResource.java`

#### APIå¤‰æ›´ç‚¹

| é …ç›® | Jersey 2.x | Jersey 3.x | å‚™è€ƒ |
|-----|-----------|-----------|------|
| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å | `javax.ws.rs.*` | `jakarta.ws.rs.*` | å…¨é¢å¤‰æ›´ |
| Clientã‚¯ãƒ©ã‚¹ | `javax.ws.rs.client.Client` | `jakarta.ws.rs.client.Client` | æ©Ÿèƒ½ã¯åŒä¸€ |
| WebTarget | `javax.ws.rs.client.WebTarget` | `jakarta.ws.rs.client.WebTarget` | æ©Ÿèƒ½ã¯åŒä¸€ |
| Response | `javax.ws.rs.core.Response` | `jakarta.ws.rs.core.Response` | æ©Ÿèƒ½ã¯åŒä¸€ |
| ClientBuilder | å¤‰æ›´ãªã— | å¤‰æ›´ãªã— | APIã¯äº’æ› |

#### ç§»è¡Œæ‰‹é †

1. **pom.xmlã®æ›´æ–°**
   - Jerseyä¾å­˜é–¢ä¿‚ã‚’3.1.xã«æ›´æ–°
   - jersey-hk2ã‚‚3.1.xã«æ›´æ–°

2. **importæ–‡ã®ä¸€æ‹¬ç½®æ›**
   ```bash
   find src/bff -name "*.java" -exec sed -i 's/import javax\.ws\.rs\./import jakarta.ws.rs./g' {} +
   ```

3. **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ç¢ºèªã¨ã‚¨ãƒ©ãƒ¼ä¿®æ­£**

4. **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã¨ä¿®æ­£**

#### æ¤œè¨¼è¨ˆç”»

1. BFFã®å…¨HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿæ–½
2. çµ±åˆãƒ†ã‚¹ãƒˆã§ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã®å‹•ä½œç¢ºèª
3. E2Eãƒ†ã‚¹ãƒˆã§å…¨ç”»é¢é·ç§»ã®å‹•ä½œç¢ºèª

---

### 3. Payaraèµ·å‹•è¨­å®šèª¿æŸ»

#### ç¾çŠ¶åˆ†æ

- **ç¾åœ¨**: Payara Micro 5.2022.5ï¼ˆJakarta EE 8ï¼‰
- **ç›®æ¨™**: Payara Micro 6.2024.10ï¼ˆJakarta EE 10ï¼‰
- **èµ·å‹•æ–¹æ³•**: Jarãƒ•ã‚¡ã‚¤ãƒ«ç›´æ¥å®Ÿè¡Œï¼ˆ`java -jar /opt/payara-micro.jar --deploy target/*.war --port 808X`ï¼‰

#### äº’æ›æ€§è©•ä¾¡

**âš ï¸ JVMã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨˜è¿°å­ã«å¤‰æ›´ã‚ã‚Š**

1. **JVMã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ¨å¥¨å¤‰æ›´**

   | é …ç›® | Java 11 | Java 21 | å‚™è€ƒ |
   |-----|---------|---------|------|
   | GCã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | G1GCï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ | G1GCï¼ˆæ¨å¥¨ï¼‰<br/>ã¾ãŸã¯ZGC | ZGCã¯ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·å‘ã‘ |
   | ãƒ¡ãƒ¢ãƒªè¨­å®š | `-Xmx512m` | `-Xmx512m` | å¤‰æ›´ä¸è¦ |
   | JMXè¨­å®š | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å¤‰æ›´ä¸è¦ |
   | ãƒ‡ãƒãƒƒã‚°ãƒãƒ¼ãƒˆ | `-agentlib:jdwp=...` | `-agentlib:jdwp=...` | å¤‰æ›´ä¸è¦ |

   **æ¨å¥¨JVMã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆJava 21ï¼‰**:
   ```bash
   java -Xmx512m \
        -XX:+UseG1GC \
        -XX:MaxGCPauseMillis=200 \
        -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:500X \
        -jar /opt/payara-micro.jar \
        --deploy target/*.war \
        --port 808X
   ```

2. **ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨˜è¿°å­ã®å¤‰æ›´**

   **web.xml**:
   ```xml
   <!-- å¤‰æ›´å‰ï¼ˆJakarta EE 8ï¼‰ -->
   <web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
            version="4.0">
   
   <!-- å¤‰æ›´å¾Œï¼ˆJakarta EE 10ï¼‰ -->
   <web-app xmlns="https://jakarta.ee/xml/ns/jakartaee"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="https://jakarta.ee/xml/ns/jakartaee 
                                https://jakarta.ee/xml/ns/jakartaee/web-app_6_0.xsd"
            version="6.0">
   ```

   **glassfish-resources.xml**:
   ```xml
   <!-- å¤‰æ›´å‰ -->
   <jdbc-connection-pool res-type="javax.sql.DataSource" ...>
   
   <!-- å¤‰æ›´å¾Œ -->
   <jdbc-connection-pool res-type="jakarta.sql.DataSource" ...>
   ```

3. **Payara Microãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—æ™‚ã®å¤‰æ›´ç‚¹**

   - **èµ·å‹•ã‚³ãƒãƒ³ãƒ‰**: å¤‰æ›´ãªã—ï¼ˆäº’æ›æ€§ç¶­æŒï¼‰
   - **ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿**: `${ENV=å¤‰æ•°å}`æ§‹æ–‡ã¯ç¶™ç¶šã‚µãƒãƒ¼ãƒˆ
   - **ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•**: `--deploy`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ç¶™ç¶šã‚µãƒãƒ¼ãƒˆ
   - **ãƒãƒ¼ãƒˆæŒ‡å®š**: `--port`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ç¶™ç¶šã‚µãƒãƒ¼ãƒˆ

#### å½±éŸ¿ç¯„å›²

1. **DevContainerè¨­å®š**
   - `.devcontainer/Dockerfile`: Payara Microã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å…ˆã‚’å¤‰æ›´
   - Java 11 â†’ Java 21ã‚¤ãƒ¡ãƒ¼ã‚¸ã¸ã®å¤‰æ›´

2. **èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
   - README.mdã®ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
   - E2Eãƒ†ã‚¹ãƒˆã®ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ`src/e2e/scripts/manage-services.sh`ï¼‰

3. **ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨˜è¿°å­**
   - å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®`web.xml`ï¼ˆ4ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
   - å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®`glassfish-resources.xml`ï¼ˆ3ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

#### ç§»è¡Œæ‰‹é †

1. **DevContainerã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸å¤‰æ›´**
   ```dockerfile
   # å¤‰æ›´å‰
   FROM mcr.microsoft.com/devcontainers/java:1-11-bullseye
   
   # å¤‰æ›´å¾Œ
   FROM mcr.microsoft.com/devcontainers/java:1-21-bookworm
   ```

2. **Payara Microãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´**
   ```dockerfile
   # å¤‰æ›´å‰
   ARG PAYARA_VERSION=5.2022.5
   
   # å¤‰æ›´å¾Œ
   ARG PAYARA_VERSION=6.2024.10
   ```

3. **pom.xmlã®Javaãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´**
   ```xml
   <maven.compiler.source>21</maven.compiler.source>
   <maven.compiler.target>21</maven.compiler.target>
   ```

4. **ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨˜è¿°å­ã®æ›´æ–°**
   - web.xmlã®namespaceæ›´æ–°ï¼ˆå…¨4ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
   - glassfish-resources.xmlã®`javax.sql` â†’ `jakarta.sql`å¤‰æ›´ï¼ˆå…¨3ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

#### æ¤œè¨¼è¨ˆç”»

1. DevContainerã®ãƒ“ãƒ«ãƒ‰ã¨èµ·å‹•ç¢ºèª
2. å„ã‚µãƒ¼ãƒ“ã‚¹ã®å€‹åˆ¥èµ·å‹•ç¢ºèª
3. E2Eãƒ†ã‚¹ãƒˆã§ã®çµ±åˆå‹•ä½œç¢ºèª

---

### 4. ä¸¦è¡Œå®Ÿè¡Œç’°å¢ƒèª¿æŸ»

#### ç¾çŠ¶åˆ†æ

- **Mavenä¸¦è¡Œãƒ“ãƒ«ãƒ‰**: ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„
- **TestContainersã®ä¸¦è¡Œå®Ÿè¡Œ**: ãƒãƒ¼ãƒˆç«¶åˆã®ãƒªã‚¹ã‚¯ã‚ã‚Š
- **ä¸¦è¡Œãƒ†ã‚¹ãƒˆå¯¾è±¡**: user-serviceã¨point-serviceã®çµ±åˆãƒ†ã‚¹ãƒˆ

#### èª²é¡Œã¨å¯¾ç­–

1. **TestContainersã®ãƒãƒ¼ãƒˆç«¶åˆ**

   **èª²é¡Œ**:
   - TestContainersã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ©ãƒ³ãƒ€ãƒ ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ãŒã€è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆãŒåŒæ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã¨Docker APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒç«¶åˆã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
   - PostgreSQLã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã«æ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚ã€ä¸¦è¡Œå®Ÿè¡Œã§å…¨ä½“æ™‚é–“ãŒçŸ­ç¸®ã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚‹

   **å¯¾ç­–**:
   ```xml
   <!-- pom.xmlã®maven-failsafe-pluginã«è¨­å®š -->
   <plugin>
       <groupId>org.apache.maven.plugins</groupId>
       <artifactId>maven-failsafe-plugin</artifactId>
       <version>3.2.5</version>
       <configuration>
           <forkCount>1</forkCount>
           <reuseForks>false</reuseForks>
           <parallel>none</parallel> <!-- ä¸¦è¡Œå®Ÿè¡Œã‚’ç„¡åŠ¹åŒ– -->
       </configuration>
   </plugin>
   ```

2. **Dockerãƒªã‚½ãƒ¼ã‚¹è¨­å®šã®æœ€é©åŒ–**

   **æ¨å¥¨è¨­å®š**:
   ```yaml
   # Docker Desktopã®æ¨å¥¨è¨­å®š
   resources:
     cpus: 4
     memory: 8GB
     swap: 2GB
   ```

   **TestContainersã®è¨­å®š**:
   ```java
   // ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã«è¿½åŠ 
   @Testcontainers
   class UserServiceIT {
       @Container
       static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:15-alpine")
           .withReuse(true)  // ã‚³ãƒ³ãƒ†ãƒŠã®å†åˆ©ç”¨
           .withLabel("testcontainers.reuse.enable", "true");
   }
   ```

3. **Mavenä¸¦è¡Œãƒ“ãƒ«ãƒ‰ã®è¨­å®š**

   **æ¨å¥¨ã‚³ãƒãƒ³ãƒ‰**:
   ```bash
   # ä¸¦è¡Œãƒ“ãƒ«ãƒ‰ï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆã¯é †æ¬¡å®Ÿè¡Œï¼‰
   mvn clean package -T 4C -DskipTests
   
   # çµ±åˆãƒ†ã‚¹ãƒˆã¯å€‹åˆ¥å®Ÿè¡Œ
   cd src/user-service && mvn verify -DskipUTs
   cd src/auth-service && mvn verify -DskipUTs
   cd src/point-service && mvn verify -DskipUTs
   ```

#### æ¤œè¨¼è¨ˆç”»

1. ä¸¦è¡Œãƒ“ãƒ«ãƒ‰ã®å®Ÿè¡Œæ™‚é–“æ¸¬å®šï¼ˆ-T 1C vs -T 4Cï¼‰
2. TestContainersã®å†åˆ©ç”¨è¨­å®šã§ã®ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡æ¸¬å®š
3. çµ±åˆãƒ†ã‚¹ãƒˆã®å®‰å®šæ€§ç¢ºèªï¼ˆ10å›é€£ç¶šå®Ÿè¡Œï¼‰

---

### 5. E2Eç’°å¢ƒèª¿æŸ»

#### ç¾çŠ¶åˆ†æ

- **E2Eãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Playwright + Cucumber
- **ãƒ†ã‚¹ãƒˆç”¨DB**: TestContainersï¼ˆPostgreSQL Ã— 3ï¼‰
- **ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•**: Payara Micro Ã— 4 + Vite Ã— 1
- **ç’°å¢ƒå¤‰æ•°ç®¡ç†**: `.env`ã¨`.env.e2e`ã®è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ

#### E2Eå®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
1. TestContainersèµ·å‹•ï¼ˆBeforeAllï¼‰
   â”œâ”€â”€ PostgreSQL Ã— 3 èµ·å‹•ï¼ˆuser, auth, pointï¼‰
   â”œâ”€â”€ ã‚¹ã‚­ãƒ¼ãƒï¼†Seedãƒ‡ãƒ¼ã‚¿æŠ•å…¥
   â””â”€â”€ .env.e2eãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•ç”Ÿæˆ

2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
   â”œâ”€â”€ .env.e2eã‹ã‚‰ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿
   â”œâ”€â”€ WARãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ“ãƒ«ãƒ‰ï¼ˆmvn clean packageï¼‰
   â””â”€â”€ Payara Microã«ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ4ã‚µãƒ¼ãƒ“ã‚¹ä¸¦è¡Œèµ·å‹•ï¼‰

3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•
   â””â”€â”€ Vite dev serverï¼ˆãƒãƒ¼ãƒˆ3000ï¼‰

4. E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   â”œâ”€â”€ Cucumberã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œ
   â””â”€â”€ å„ã‚·ãƒŠãƒªã‚ªå‰ã«DBåˆæœŸåŒ–

5. ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆAfterAllï¼‰
   â”œâ”€â”€ ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
   â””â”€â”€ TestContainersåœæ­¢
```

#### äº’æ›æ€§è©•ä¾¡ã¨å¯¾å¿œ

**âœ… Java 21 / Payara 6ç§»è¡Œå¾Œã‚‚åŒæ§˜ã®ãƒ•ãƒ­ãƒ¼ã‚’ç¶­æŒ**

1. **WARãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆæ‰‹é †**
   - å¤‰æ›´ãªã—ï¼ˆ`mvn clean package`ã§ç”Ÿæˆï¼‰
   - Jakarta EE 10å¯¾å¿œã®WARãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹

2. **Payara Microã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †**
   - ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ã¯å¤‰æ›´ãªã—
   - Java 21ã§èµ·å‹•ã•ã‚Œã‚‹Payara Micro 6ã«ãƒ‡ãƒ—ãƒ­ã‚¤

3. **E2Eãƒ†ã‚¹ãƒˆDBåˆæœŸåŒ–æ‰‹é †**
   - TestContainersã®APIã¯å¤‰æ›´ãªã—
   - ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆschema.sqlï¼‰ã¯å¤‰æ›´ä¸è¦
   - Seedãƒ‡ãƒ¼ã‚¿æŠ•å…¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å¤‰æ›´ä¸è¦

4. **ç’°å¢ƒå¤‰æ•°ç®¡ç†**
   - `.env`ã¨`.env.e2e`ã®åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯ã¯å¤‰æ›´ä¸è¦
   - `${ENV=å¤‰æ•°å}`æ§‹æ–‡ã¯Payara 6ã§ã‚‚ç¶™ç¶šã‚µãƒãƒ¼ãƒˆ

#### å½±éŸ¿ç¯„å›²

1. **ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¿®æ­£**
   - `src/e2e/scripts/manage-services.sh`: Javaãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   
2. **Dockerè¨­å®š**
   - DevContainerã®Javaãƒãƒ¼ã‚¸ãƒ§ãƒ³å¤‰æ›´ã«ä¼´ã†è‡ªå‹•å¯¾å¿œ
   
3. **èµ·å‹•æ™‚é–“**
   - Payara 6ã¯Payara 5ã¨åŒç­‰ã®èµ·å‹•æ™‚é–“ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ã‚ãŸã‚Š30ã€œ60ç§’ï¼‰

#### æ¤œè¨¼è¨ˆç”»

1. WARãƒ•ã‚¡ã‚¤ãƒ«ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®å‹•ä½œç¢ºèª
2. E2Eãƒ†ã‚¹ãƒˆã®DBåˆæœŸåŒ–å‡¦ç†ã®å‹•ä½œç¢ºèª
3. å…¨E2Eãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã®å®Ÿè¡Œç¢ºèªï¼ˆ10å›é€£ç¶šå®Ÿè¡Œã§å®‰å®šæ€§ç¢ºèªï¼‰

---

## ç§»è¡Œæ™‚ã®æ³¨æ„ç‚¹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. æ®µéšçš„ãªç§»è¡Œã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**æ¨å¥¨ç§»è¡Œé †åº**:
1. **ãƒ•ã‚§ãƒ¼ã‚º1**: Java 21 + Payara 6ã¸ã®ç§»è¡Œï¼ˆJakarta EE 8ç¶­æŒï¼‰
2. **ãƒ•ã‚§ãƒ¼ã‚º2**: Jakarta EE 10ã¸ã®ç§»è¡Œï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åå¤‰æ›´ï¼‰
3. **ãƒ•ã‚§ãƒ¼ã‚º3**: ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æœ€é©åŒ–ï¼ˆjbcrypt, Jerseyãªã©ï¼‰

**ç†ç”±**: å¤‰æ›´ã‚’åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€å•é¡Œç™ºç”Ÿæ™‚ã®åŸå› ç‰¹å®šãŒå®¹æ˜“ã«ãªã‚‹

### 2. å¾Œæ–¹äº’æ›æ€§ã®ç¶­æŒ

- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥**: æ—¢å­˜DBã®ãƒãƒƒã‚·ãƒ¥ã¯å¼•ãç¶šãæ¤œè¨¼å¯èƒ½
- **APIä»•æ§˜**: BFF APIã¯å¤‰æ›´ãªã—ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¸ã®å½±éŸ¿ãªã—ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ**: å¤‰æ›´ãªã—

### 3. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

| ãƒ†ã‚¹ãƒˆãƒ¬ãƒ™ãƒ« | å®Ÿæ–½å†…å®¹ | ç›®çš„ |
|------------|---------|------|
| ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | å…¨ã‚µãƒ¼ãƒ“ã‚¹ã§å®Ÿæ–½ | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åå¤‰æ›´ã®å½±éŸ¿ç¢ºèª |
| çµ±åˆãƒ†ã‚¹ãƒˆ | TestContainersã§å®Ÿæ–½ | DBæ¥ç¶šã¨ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ç¢ºèª |
| E2Eãƒ†ã‚¹ãƒˆ | Playwright + Cucumberã§å®Ÿæ–½ | ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®å‹•ä½œç¢ºèª |

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–

- **Java 21ã®GCæ”¹å–„**: G1GCã¾ãŸã¯ZGCã®æ€§èƒ½å‘ä¸Šã‚’æœŸå¾…
- **Payara 6ã®æœ€é©åŒ–**: Jakarta EE 10ã®æ€§èƒ½æ”¹å–„ã‚’ç¢ºèª
- **ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å–å¾—**: ç§»è¡Œå‰å¾Œã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã‚’æ¸¬å®š

### 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

- **Java 21ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒ**: æœ€æ–°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿®æ­£ã‚’äº«å—
- **ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–°**: è„†å¼±æ€§ã®ã‚ã‚‹æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã®è„±å´
- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥**: BCryptã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ç¶™ç¶šä½¿ç”¨ï¼ˆæ¥­ç•Œæ¨™æº–ï¼‰

---

## Gitãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

### ãƒ–ãƒ©ãƒ³ãƒãƒ¢ãƒ‡ãƒ«

```
main (production)
  â””â”€â”€ develop (development)
        â””â”€â”€ feature/java21-migration (ç§»è¡Œä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒ)
              â”œâ”€â”€ feature/java21-phase1-payara6 (ãƒ•ã‚§ãƒ¼ã‚º1: Payara 6ç§»è¡Œ)
              â”œâ”€â”€ feature/java21-phase2-jakartaee10 (ãƒ•ã‚§ãƒ¼ã‚º2: Jakarta EE 10ç§»è¡Œ)
              â””â”€â”€ feature/java21-phase3-dependencies (ãƒ•ã‚§ãƒ¼ã‚º3: ä¾å­˜é–¢ä¿‚æœ€é©åŒ–)
```

### ãƒ–ãƒ©ãƒ³ãƒé‹ç”¨ãƒ«ãƒ¼ãƒ«

1. **feature/java21-phase1-payara6**
   - Java 11 â†’ Java 21
   - Payara 5 â†’ Payara 6ï¼ˆJakarta EE 8ã®ã¾ã¾ï¼‰
   - DevContainerã€Dockerfileã®æ›´æ–°
   - å…¨ãƒ†ã‚¹ãƒˆãŒã‚°ãƒªãƒ¼ãƒ³ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª

2. **feature/java21-phase2-jakartaee10**
   - Jakarta EE 8 â†’ Jakarta EE 10
   - `javax.*` â†’ `jakarta.*`ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åå¤‰æ›´
   - Jersey 2.x â†’ Jersey 3.x
   - web.xmlã€glassfish-resources.xmlã®æ›´æ–°

3. **feature/java21-phase3-dependencies**
   - org.mindrot:jbcrypt 0.4 â†’ at.favre.lib:bcrypt 0.10.2
   - PostgreSQL Driveræœ€æ–°ç‰ˆã¸ã®æ›´æ–°
   - ãã®ä»–ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æœ€é©åŒ–

### ãƒãƒ¼ã‚¸æˆ¦ç•¥

- **å„ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†å¾Œ**: developãƒ–ãƒ©ãƒ³ãƒã¸ã®PRã¨ãƒãƒ¼ã‚¸
- **å…¨ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†å¾Œ**: mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒãƒ¼ã‚¸ï¼ˆæœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ï¼‰
- **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å¿…é ˆï¼ˆæœ€ä½2åã®ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ï¼‰
- **CI/CD**: å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## åˆ‡ã‚Šæˆ»ã—æ‰‹é †

### ç§»è¡Œå‰ã®æº–å‚™

1. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–å¾—**
   ```bash
   # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
   pg_dump -h localhost -p 5432 -U postgres user_service_db > backup_user_service.sql
   pg_dump -h localhost -p 5432 -U postgres auth_service_db > backup_auth_service.sql
   pg_dump -h localhost -p 5432 -U postgres point_service_db > backup_point_service.sql
   ```

2. **ç¾è¡Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚¿ã‚°ä½œæˆ**
   ```bash
   git tag -a v1.0.0-java11 -m "Java 11 + Payara 5 + Jakarta EE 8 version"
   git push origin v1.0.0-java11
   ```

### åˆ‡ã‚Šæˆ»ã—æ‰‹é †

#### ã‚·ãƒŠãƒªã‚ª1: é–‹ç™ºç’°å¢ƒã§ã®å•é¡Œç™ºè¦šï¼ˆãƒ•ã‚§ãƒ¼ã‚ºé€”ä¸­ï¼‰

```bash
# 1. è©²å½“ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã‚’ç ´æ£„
git checkout develop
git branch -D feature/java21-phaseX

# 2. æ–°è¦ãƒ–ãƒ©ãƒ³ãƒã§ä¿®æ­£ä½œæ¥­
git checkout -b feature/java21-phaseX-fix develop

# 3. å•é¡Œã‚’ä¿®æ­£ã—ã¦å†åº¦ãƒãƒ¼ã‚¸
```

#### ã‚·ãƒŠãƒªã‚ª2: çµ±åˆå¾Œã®å•é¡Œç™ºè¦šï¼ˆdevelopç’°å¢ƒï¼‰

```bash
# 1. developãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰å•é¡Œã‚³ãƒŸãƒƒãƒˆã‚’revert
git revert <commit-hash>

# 2. ä¿®æ­£ç‰ˆã‚’æ–°è¦ãƒ–ãƒ©ãƒ³ãƒã§ä½œæˆ
git checkout -b feature/java21-fix develop

# 3. ä¿®æ­£å¾Œã«å†åº¦PR
```

#### ã‚·ãƒŠãƒªã‚ª3: æœ¬ç•ªç’°å¢ƒã§ã®è‡´å‘½çš„ãªå•é¡Œç™ºè¦š

```bash
# 1. mainãƒ–ãƒ©ãƒ³ãƒã‚’æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
git checkout main
git revert <migration-merge-commit>
git push origin main

# 2. æœ¬ç•ªç’°å¢ƒã‚’å†ãƒ‡ãƒ—ãƒ­ã‚¤
# DevContainerã‚’å†ãƒ“ãƒ«ãƒ‰ï¼ˆJava 11ã‚¤ãƒ¡ãƒ¼ã‚¸ã«æˆ»ã™ï¼‰

# 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚¹ãƒˆã‚¢ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
psql -h localhost -p 5432 -U postgres user_service_db < backup_user_service.sql
```

### åˆ‡ã‚Šæˆ»ã—å¾Œã®ç¢ºèªäº‹é …

- [ ] å…¨ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«èµ·å‹•ã™ã‚‹ã“ã¨
- [ ] E2Eãƒ†ã‚¹ãƒˆãŒå…¨ã¦ãƒ‘ã‚¹ã™ã‚‹ã“ã¨
- [ ] ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨
- [ ] ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒæ­£å¸¸ã§ã‚ã‚‹ã“ã¨

---

## ãƒªãƒªãƒ¼ã‚¹åˆ¤å®šåŸºæº–

### å¿…é ˆæ¡ä»¶ï¼ˆGo/No-GoåŸºæº–ï¼‰

| No | é …ç›® | åˆ¤å®šåŸºæº– | ç¢ºèªæ–¹æ³• |
|----|-----|---------|---------|
| 1 | ãƒ“ãƒ«ãƒ‰æˆåŠŸ | å…¨ã‚µãƒ¼ãƒ“ã‚¹ãŒ`mvn clean package`ã§ãƒ“ãƒ«ãƒ‰æˆåŠŸ | CIãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ |
| 2 | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ | å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒ100%ãƒ‘ã‚¹ | `mvn test` |
| 3 | çµ±åˆãƒ†ã‚¹ãƒˆ | å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®çµ±åˆãƒ†ã‚¹ãƒˆãŒ100%ãƒ‘ã‚¹ | `mvn verify` |
| 4 | E2Eãƒ†ã‚¹ãƒˆ | å…¨E2Eã‚·ãƒŠãƒªã‚ªãŒ100%ãƒ‘ã‚¹ | `npm run test:cucumber` |
| 5 | ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹• | å…¨ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«èµ·å‹•ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãªã—ï¼‰ | æ‰‹å‹•ç¢ºèª |
| 6 | APIå‹•ä½œç¢ºèª | BFFã®ã™ã¹ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£å¸¸å¿œç­” | æ‰‹å‹•ã¾ãŸã¯Postman |
| 7 | èªè¨¼æ©Ÿèƒ½ | æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½ | E2Eãƒ†ã‚¹ãƒˆ |
| 8 | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ | æ—¢å­˜ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã§èªè¨¼å¯èƒ½ | çµ±åˆãƒ†ã‚¹ãƒˆ |
| 9 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ | è„†å¼±æ€§ãŒæ¤œå‡ºã•ã‚Œãªã„ã“ã¨ | Dependabot, Snyk |
| 10 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãŒç¾è¡Œæ¯”120%ä»¥å†… | ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ |

### æ¨å¥¨æ¡ä»¶ï¼ˆå“è³ªå‘ä¸Šã®ãŸã‚ã®è¿½åŠ åŸºæº–ï¼‰

| No | é …ç›® | åˆ¤å®šåŸºæº– | ç¢ºèªæ–¹æ³• |
|----|-----|---------|---------|
| 11 | ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ | 70%ä»¥ä¸Šã‚’ç¶­æŒ | JaCoCo |
| 12 | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | ç¾è¡Œæ¯”150%ä»¥å†… | JVMç›£è¦– |
| 13 | èµ·å‹•æ™‚é–“ | ç¾è¡Œæ¯”120%ä»¥å†… | æ‰‹å‹•æ¸¬å®š |
| 14 | ãƒ­ã‚°ã‚¨ãƒ©ãƒ¼ | èµ·å‹•æ™‚ã®ERRORãƒ­ã‚°ãªã— | ãƒ­ã‚°ç¢ºèª |
| 15 | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–° | READMEã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã®æ›´æ–° | ãƒ¬ãƒ“ãƒ¥ãƒ¼ |

### ãƒªãƒªãƒ¼ã‚¹å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] å…¨å¿…é ˆæ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹
- [ ] æ¨å¥¨æ¡ä»¶ã‚’70%ä»¥ä¸Šæº€ãŸã—ã¦ã„ã‚‹
- [ ] ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®Œäº†ã—ã¦ã„ã‚‹ï¼ˆæœ€ä½2åï¼‰
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæœ€æ–°åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] åˆ‡ã‚Šæˆ»ã—æ‰‹é †ãŒæº–å‚™ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå–å¾—ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã¸ã®é€šçŸ¥ãŒå®Œäº†ã—ã¦ã„ã‚‹

### ãƒªãƒªãƒ¼ã‚¹å¾Œãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

**ç›£è¦–æœŸé–“**: ãƒªãƒªãƒ¼ã‚¹å¾Œ48æ™‚é–“

**ç›£è¦–é …ç›®**:
1. **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°**: ã‚¨ãƒ©ãƒ¼ã€è­¦å‘Šã®ç™ºç”ŸçŠ¶æ³
2. **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ **: å¹³å‡ã€90ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ã€99ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«
3. **ã‚¨ãƒ©ãƒ¼ç‡**: HTTP 5xxã€4xxã‚¨ãƒ©ãƒ¼ã®ç™ºç”Ÿç‡
4. **ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡**: CPUã€ãƒ¡ãƒ¢ãƒªã€ãƒ‡ã‚£ã‚¹ã‚¯I/O
5. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: å•ã„åˆã‚ã›ã€ä¸å…·åˆå ±å‘Š

**ã‚¢ãƒ©ãƒ¼ãƒˆæ¡ä»¶**:
- ã‚¨ãƒ©ãƒ¼ç‡ãŒ5%ã‚’è¶…ãˆãŸå ´åˆ
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãŒå¹³å‡ã®2å€ã‚’è¶…ãˆãŸå ´åˆ
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒ90%ã‚’è¶…ãˆãŸå ´åˆ

**ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**:
- ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç”Ÿæ™‚ã¯å³åº§ã«é–‹ç™ºãƒãƒ¼ãƒ ã«é€šçŸ¥
- 30åˆ†ä»¥å†…ã«æ”¹å–„ã—ãªã„å ´åˆã¯åˆ‡ã‚Šæˆ»ã—ã‚’æ¤œè¨

---

## ç§»è¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæƒ³å®šï¼‰

| ãƒ•ã‚§ãƒ¼ã‚º | ã‚¿ã‚¹ã‚¯ | æœŸé–“ | æ‹…å½“ |
|---------|-------|------|------|
| **æº–å‚™** | æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ | 0.5æ—¥ | âœ… å®Œäº† |
| **æº–å‚™** | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–å¾—ã€ã‚¿ã‚°ä½œæˆ | 0.5æ—¥ | æ¬¡å› |
| **ãƒ•ã‚§ãƒ¼ã‚º1** | Java 21 + Payara 6ç§»è¡Œ | 2æ—¥ | æ¬¡å› |
| **ãƒ•ã‚§ãƒ¼ã‚º1** | ãƒ†ã‚¹ãƒˆå®Ÿæ–½ã¨ä¿®æ­£ | 1æ—¥ | æ¬¡å› |
| **ãƒ•ã‚§ãƒ¼ã‚º2** | Jakarta EE 10ç§»è¡Œ | 2æ—¥ | æ¬¡å› |
| **ãƒ•ã‚§ãƒ¼ã‚º2** | ãƒ†ã‚¹ãƒˆå®Ÿæ–½ã¨ä¿®æ­£ | 1æ—¥ | æ¬¡å› |
| **ãƒ•ã‚§ãƒ¼ã‚º3** | ä¾å­˜é–¢ä¿‚æœ€é©åŒ– | 1æ—¥ | æ¬¡å› |
| **ãƒ•ã‚§ãƒ¼ã‚º3** | ãƒ†ã‚¹ãƒˆå®Ÿæ–½ã¨ä¿®æ­£ | 0.5æ—¥ | æ¬¡å› |
| **çµ±åˆ** | å…¨ä½“çµ±åˆãƒ†ã‚¹ãƒˆ | 1æ—¥ | æ¬¡å› |
| **çµ±åˆ** | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ | 0.5æ—¥ | æ¬¡å› |
| **ãƒªãƒªãƒ¼ã‚¹** | æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ | 0.5æ—¥ | æ¬¡å› |
| **ãƒªãƒªãƒ¼ã‚¹** | ç›£è¦–ã¨ãƒ•ã‚©ãƒ­ãƒ¼ | 2æ—¥ | æ¬¡å› |
| **åˆè¨ˆ** | | ç´„12æ—¥ | |

---

## å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

1. **Java 21**
   - [JDK 21 Release Notes](https://www.oracle.com/java/technologies/javase/21-relnote-issues.html)
   - [Java 21 New Features](https://openjdk.org/projects/jdk/21/)

2. **Payara 6**
   - [Payara Platform 6 Documentation](https://docs.payara.fish/community/docs/6.2024.10/overview.html)
   - [Migration Guide: Payara 5 to 6](https://docs.payara.fish/community/docs/6.2024.10/migration/payara5-to-6.html)

3. **Jakarta EE 10**
   - [Jakarta EE 10 Specification](https://jakarta.ee/specifications/platform/10/)
   - [Jakarta EE 10 Release Plan](https://jakarta.ee/release/10/)

4. **Jersey 3.x**
   - [Jersey 3.1 User Guide](https://eclipse-ee4j.github.io/jersey/)
   - [Jersey Migration Guide](https://eclipse-ee4j.github.io/jersey.github.io/documentation/latest/migration.html)

5. **bcrypt**
   - [at.favre.lib:bcrypt Documentation](https://github.com/patrickfav/bcrypt)
   - [jbcrypt (org.mindrot) Repository](https://github.com/jeremyh/jbcrypt)

### é–¢é€£Issue

- **è¦ªIssue**: [Takas0522/my-ws-demo#27] Java 21ã€Payara 6ã€Jakarta EE 10ã¸ã®ç§»è¡Œ

---

## æ”¹è¨‚å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | æ”¹è¨‚å†…å®¹ | ä½œæˆè€… |
|-----------|------|---------|--------|
| 1.0.0 | 2024-12-13 | åˆç‰ˆä½œæˆ | GitHub Copilot |

---

## ã¾ã¨ã‚

æœ¬èª¿æŸ»ã«ã‚ˆã‚Šã€Java 21 + Payara 6 + Jakarta EE 10ã¸ã®ç§»è¡Œã¯æŠ€è¡“çš„ã«å®Ÿè¡Œå¯èƒ½ã§ã‚ã‚Šã€ä»¥ä¸‹ã®ç‚¹ãŒæ˜ç¢ºã«ãªã‚Šã¾ã—ãŸï¼š

### âœ… ç§»è¡Œå¯èƒ½ãªé …ç›®
- bcryptãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆorg.mindrot:jbcrypt 0.4 â†’ at.favre.lib:bcrypt 0.10.2ï¼‰ï¼ˆå®Œå…¨äº’æ›ã€ã‚³ãƒ¼ãƒ‰å¤‰æ›´ä¸è¦ï¼‰
- TestContainersã®ç¶™ç¶šåˆ©ç”¨ï¼ˆAPIã¯å¤‰æ›´ãªã—ï¼‰
- E2Eç’°å¢ƒã®ç¶­æŒï¼ˆãƒ•ãƒ­ãƒ¼å¤‰æ›´ãªã—ï¼‰

### âš ï¸ ç§»è¡Œã«æ³¨æ„ãŒå¿…è¦ãªé …ç›®
- Jersey 2.x â†’ 3.xï¼ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åå¤‰æ›´ã€ã‚³ãƒ¼ãƒ‰ä¿®æ­£å¿…é ˆï¼‰
- ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨˜è¿°å­ï¼ˆweb.xmlã€glassfish-resources.xmlï¼‰ã®æ›´æ–°
- DevContainerã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸å¤‰æ›´

### ğŸ¯ ç§»è¡Œã®ãƒ¡ãƒªãƒƒãƒˆ
- **é•·æœŸã‚µãƒãƒ¼ãƒˆ**: Java 21ã¯LTSç‰ˆï¼ˆ2029å¹´9æœˆã¾ã§ã‚µãƒãƒ¼ãƒˆï¼‰
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š**: Java 21ã®GCæ”¹å–„ã€Payara 6ã®æœ€é©åŒ–
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: æœ€æ–°ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã‚’äº«å—
- **å°†æ¥æ€§**: Jakarta EE 10ãŒä»Šå¾Œã®æ¨™æº–ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

### ğŸ“Š æ¨å¥¨ç§»è¡Œã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
**æ®µéšçš„ç§»è¡Œ**ï¼ˆãƒ•ã‚§ãƒ¼ã‚º1â†’2â†’3ï¼‰ã«ã‚ˆã‚Šã€ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–ã—ãªãŒã‚‰ç¢ºå®Ÿã«ç§»è¡Œã‚’é€²ã‚ã‚‹ã€‚

ç§»è¡Œä½œæ¥­ã¯ç´„12æ—¥é–“ï¼ˆä½œæ¥­æ—¥ãƒ™ãƒ¼ã‚¹ï¼‰ã§å®Œäº†è¦‹è¾¼ã¿ã€‚
