# 5.新しい機能の追加

## このチャレンジで体験できること

* Planモードを使用したアップグレードプラン構築
* Custom Agentの構築と利用
* (Opt)IssueへのCopilotの割り当て作業の実施

> [!NOTE]
> 途中から参加する場合は `challenge5` ブランチに切り替えてください。

## 目的

新しく機能を追加します。ポイントの履歴は参照できますがポイントの利用自体は行えないため個別のサービスを構築しポイントを利用できるように回収していきます。
想像するだに大きな作業となるため作業工程などを明確化し、テストをクリアしながら実施していきます。
テストを作成する工程は個別のタスクになりそうなので、テストルールを明文化しエージェントを構築して作業を円滑に進めるようにします。

## 手順

1. Agentの参照元となるドキュメントの構築

``` markdown
現在のテストコードを参照に、unit, integration, e2eのテスト構築時のルールをまとめてください。
それぞれのテストの観点が異なるため、unit, integration, e2eのドキュメントはそれぞれ別に分けてください
<!-- 以降は好きなように調整可能 -->
- `develop-standard` に共通規約があるためここに記載されている内容を反映してください。
- 各テストの完了条件を把握するためのチェックリストを構成してください
- インストラクションなどで使用する想定の為下記ブログで言及されている内容について注意してください
    - https://github.blog/ai-and-ml/unlocking-the-full-power-of-copilot-code-review-master-your-instructions-files/
```

2. Agentの作成

``` markdown
unit, integration, e2eそれぞれのカスタムエージェントを作成します。
`docs`の各テストのドキュメントや`develop-standard/agent-templates`や `develop-standard/prompt-templates` に記載されている内容をベースに作成し
`.github/agents`に格納してください。
<!-- 以降は好きなように調整可能 -->
- ドキュメントの2重管理は好ましくないので `docs`内のドキュメントに記載されている内容は参照して参考するなどしてください。
```

3. 仕様の作成

``` markdown
ポイントの利用をするためのサービスを新しく構築します。
他サービス同様、単独で完結するようDBを含む単独サービスとして構築してください。
データの同期はWebAPIを介して実行されます。
<!-- 以降は好きな仕様を構築 -->
- ユーザーが所持しているポイントを利用して、ポイントサービス内で管理されている製品を購入します
- ポイントの借金はできません
- 現在のポイントの情報と履歴はポイント履歴のサービスから取得します
- 製品は下記のようなものが提供されます
  - 数量・消費ポイント固定製品:固定数量までしか指定できない固定ポイント型の製品です（ex:数量限定商品）
  - 消費ポイント固定・数量変動可能製品:製品*個数のような形で指定する製品です（ex:一般商品）
  - 数量固定・消費ポイント変動可能製品:ポイント数をユーザーが設定できるような製品です（ex:利用量の割引など）
以上の仕様のサービスを構築します。
作業を実施するうえで不明点などあればOpen Questionなどで確認を行ってください。
```

4. タスクの作成

> [!NOTE]
> Forkなどを行わず、ローカルでのみ実行確認をする必要がありそうな場合はこちら

``` markdown
生成されたプランを、開発者やAIが実行可能な粒度のIssueに分割します。
Issue同士の依存関係がわかるように記載をして下さい。

分割したIssueをMarkdownで `docs/specs/00x-{spec name}` ディレクトリ内にIssueごとに保存してください。
各Issueの中でテストの構築も実施し、作業の完了基準として参照します。Issue作業の中では実装作業の実装後、人のレビューの後、個別でテストの実装を行うというフローで実施します。
Issueの実行順序が重要であるため、ファイル名で順序がわかるようにしてください。
```

手順パターン②:ghコマンドを使用してIssueを直接作成するパターン

> [!NOTE]
> Forkなどをして、Copilotに作業をアサインしてみたい場合はこちらのパターン

``` markdown
生成されたプランを、開発者やAIが実行可能な粒度のIssueに分割します。
各Issueの中でテストの構築も実施し、作業の完了基準として参照します。Issue作業の中では実装作業の実装後、人のレビューの後、個別でテストの実装を行うというフローで実施します。
Issue同士の依存関係がわかるように記載をして下さい。

分割されたIssueをghコマンドを使用して登録してください
```

5. タスクの実行

Coding AgentへのCopilotのアサイン

or

``` markdown
`{タスクのMDファイル}` の作業を実行してください
```
テスト作業をする際にTest用のAgentを指定する